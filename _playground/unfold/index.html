<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Unravel</title>
    <style type="text/css"></style>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/3.0.14/turf.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="./js/unfold.js"></script>
    <script type="text/javascript" src="./js/wurstify.js"></script>
    <script type="text/javascript">

		$( document ).ready(function() {
	    	processFile("./data/161202_Berlin_fromMongodb.json");
		});

    	function processFile(url){
    		$.getJSON( url, function(streets) {
    			console.log('Successfully loaded ' + url);
    			var vectorStreets = convertStreetsToVector(streets);
    			var unfoldedCoordinates = unfoldAndGetCoordinates(vectorStreets);
    			var bendInformation = unfoldedCoordinates; //only to be explicit
    			wurstify.setProperties(800, 5, [160, 80]);
    			var svgCode = wurstify.getSvgCode(bendInformation);
    			$('#svg').html( svgCode );
    		});
    	}

    	function convertStreetsToVector(streets){
    		var vectorStreets = [];
    		for (var i = 0; i < streets.length; i++) {
	            var vectorStreet = unfold.getVectorLine( streets[i] );
	            vectorStreets.push( vectorStreet );
	          };
	        return vectorStreets;
    	}

    	function unfoldAndGetCoordinates(vectorStreets){
    		var coordinateStreets = [];
    		for (var i = 0; i < vectorStreets.length; i++) {
	            var street = vectorStreets[i];
	            coordinateStreets.push( unfold.getUnfoldedCoordinates(street, 1, 5) );
	        };
	        return coordinateStreets;
    	}
    </script>
  </head>
  <body>
  	<div id="svg"></div>
  </body>
 </html>