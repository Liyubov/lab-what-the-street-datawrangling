<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Street Drawer</title>
    <meta name="author" content="Stephan Bogner">
    <style type="text/css">
      body{
        background: #f7f7f7;
      }
      #canvas{
        background: #fff;
        margin: 50px auto;
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="600" height="600"></canvas>
  </body>
  <link rel="stylesheet" type="text/css" href="reset.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");
  var cursor;
  
  var cursor2 = {
    x: 0,
    y: 0
  };

  var previousCursor = {
    x: 0,
    y: 0
  };

  var previousCursorLeft = {
    x: 0,
    y: 0
  };

  var previousCursorRight = {
    x: 0,
    y: 0
  };

  var direction;
  var streetWidth = 30;

  $(document).mousemove(function(e) {
      //document.Form1.posx.value = e.pageX;
      //document.Form1.posy.value = e.pageY;

      cursor = {
        x: e.pageX - $('#canvas').offset().left,
        y: e.pageY - $('#canvas').offset().top
      }

      constraint(cursor, cursor2, 3);

      var delta = {
        x: cursor.x - previousCursor.x,
        y: cursor.y - previousCursor.y
      }

      
      var speed = Math.sqrt(Math.pow(delta.x,2) + Math.pow(delta.y,2));

      direction = Math.atan2(cursor2.y - cursor.y, cursor2.x - cursor.x) + toRadians(90);  

      var cursorLeft = {
        x: cursor.x - Math.sin(direction - toRadians(90)) * 5,
        y: cursor.y + Math.cos(direction - toRadians(90)) * 5
      }

      var cursorRight = {
        x: cursor.x - Math.sin(direction + toRadians(90)) * 5,
        y: cursor.y + Math.cos(direction + toRadians(90)) * 5
      }

      //clearCanvas();

      ctx.beginPath();
      ctx.moveTo(previousCursorLeft.x, previousCursorLeft.y);
      ctx.lineTo(previousCursorRight.x, previousCursorRight.y);
      ctx.lineTo(cursorRight.x, cursorRight.y);
      ctx.lineTo(cursorLeft.x, cursorLeft.y);
      ctx.fillStyle = "#fff";
      ctx.fill();
      ctx.closePath();

      ctx.beginPath();
      ctx.moveTo(previousCursorRight.x, previousCursorRight.y);
      ctx.lineTo(cursorRight.x, cursorRight.y);
      ctx.lineWidth = "2";
      ctx.strokeStyle = "#000";
      ctx.stroke();
      ctx.fill();
      ctx.closePath();

      ctx.beginPath();
      ctx.moveTo(previousCursorLeft.x, previousCursorLeft.y);
      ctx.lineTo(cursorLeft.x, cursorLeft.y);
      ctx.lineWidth = "2";
      ctx.strokeStyle = "#000";
      ctx.stroke();
      ctx.fill();
      ctx.closePath();
      
      // ctx.beginPath();
      // ctx.moveTo(cursor2.x, cursor2.y);
      // ctx.lineTo(cursorRight.x, cursorRight.y);
      // ctx.lineWidth = "1";
      // ctx.strokeStyle = "#7CAC48";
      // ctx.stroke();
      // ctx.fill();
      // ctx.closePath();
      
      
      previousCursor = JSON.parse( JSON.stringify( cursor ) );
      previousCursorLeft = JSON.parse( JSON.stringify( cursorLeft ) );
      previousCursorRight = JSON.parse( JSON.stringify( cursorRight ) );
  });

  function constraint(particle1, particle2, distance) {
    var dist_x = particle1.x - particle2.x;
    var dist_y = particle1.y - particle2.y;
    var actual_distance = Math.sqrt(dist_x * dist_x + dist_y * dist_y);
    var actual_angle = -Math.atan2(dist_x, dist_y);
    var error = actual_distance - distance;
    particle1.x += (error/2)*Math.sin(actual_angle);
    particle1.y -= (error/2)*Math.cos(actual_angle);
    particle2.x -= (error/2)*Math.sin(actual_angle);
    particle2.y += (error/2)*Math.cos(actual_angle);
    //line.moveTo(particle1._x, particle1._y);
    //line.lineTo(particle2._x, particle2._y);
  }

  function clearCanvas(){
      ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function toRadians(degrees) {
    return degrees * Math.PI / 180;
  };

  function toDegrees(radians) {
    return radians / Math.PI * 180;
  };
</script>
</html>