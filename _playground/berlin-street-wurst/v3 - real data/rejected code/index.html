<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>title</title>
	<meta name="author" content="Stephan Bogner">
	<meta name="description" content="Unravel the streets of Berlin">
	<link rel="stylesheet" type="text/css" href="reset.css">
	<script type="text/javascript" src="jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="papaparse.min.js"></script>

	<style type="text/css">
	body{
		padding-top: 70px;
		font-family: 'Lato', sans-serif;
	}

	h1,h2, h3{
		margin-left:  100px;
		margin-bottom: 10px;
		font-size: 2rem;
		font-weight: 300;
	}
	h3{
		margin-top: 25px;
		font-size: 1.2rem;
	}

	a{
		text-transform: uppercase;
		font-size: 0.7rem;
		color: black;
		text-decoration: none;
		opacity: 0.3;
		transition: 0.3s;
	}

	a:hover{
		opacity: 1;
	};

	
	</style>
</head>
<body>
	<div>
		<h1>Berlin's roads have a combined length of 5341,7 km</h1>
		<h2>What you see are all roads stitched together</h2>
	</div>

	<div id="svgWrapper"></div>
	<script type="text/javascript">
	var widthInMeter = 400;
	var widthInPixel = 800;
	var meterPerPixel = widthInMeter/widthInPixel;
	var url = "residential_streets_withNames_400.csv";

	Papa.parse(url, {
		download: true,
		header: true,
		complete: function(results) {
			console.log(results);
			var segments = results.data;

			var rows = [];
			rows[0] = [];

		//calculate street placement
		var countedDistance = 0;
		var countedRow = 0;
		for (var i = 0; i < segments.length; i++) {
			segment = segments[i]
			segment.length = parseFloat(segment.length);
			currentDistance = segment.length
			var prevDistance = countedDistance;
			countedDistance += currentDistance;

			if (countedDistance > widthInMeter) {
				console.log('around edge');
				
				var diff = countedDistance - widthInMeter;
				while (diff > widthInMeter) {
					var segmentPart = JSON.parse(JSON.stringify(segment));
					segmentPart.length = widthInMeter;
					diff -= widthInMeter
					rows[countedRow].push(segmentPart);
					countedRow ++;
					rows[countedRow] = [];
				};
				countedDistance = diff;

				//part before corner
				var segmentPart1 = JSON.parse(JSON.stringify(segment));
				segmentPart1.length -= diff;

				var segmentPart2 = JSON.parse(JSON.stringify(segment));
				segmentPart2.length = diff;

				countedRow ++;

				rows[countedRow] = [];
				rows[countedRow - 1].push(segmentPart1);
				rows[countedRow].push(segmentPart2);
			}else{
				var segmentPart = JSON.parse(JSON.stringify(segment));
				rows[countedRow].push(segmentPart);
			}

		};

		console.log(rows)

		//get line information
		var currentX = 0;
		var currentY = 0;

		var offsetX = 100;
		var offsetY = 100;

		var fromX = currentX;
		var fromY = currentY;
		var toX;
		var toY;
		var thickness = 0;
		var currentColor; 

		var drawI = [];

		//console.log('move to ' + fromX + ', ' + fromY);
		var slopeHeight = 10;
		for (var i = 0; i < rows.length; i++) {
			console.log('Row ' + i);
			var row = rows[i];

			currentY = i * slopeHeight;
			
			if (i % 2 == 0) {
				for (var j = 0; j < row.length; j++) {
					segment = row[j];
					thickness = segment.lanes;
					currentColor = getColorFromType(segment.highway);
					//console.log('Piece ' + j)


					currentX += segment.length;
					toX = currentX;
					toY = currentY;

					addDrawInfo(); //draw right
				};
				currentX = widthInMeter;
				console.log('down')
				toY = (i + 1) * slopeHeight;
				addDrawInfo(); //draw down
			}else{
				for (var j = row.length - 1; j >= 0; j--) {
					segment = row[j];
					thickness = segment.lanes;
					currentColor = getColorFromType(segment.highway);
					//console.log('Piece ' + j);

					currentX -= segment.length;

					toX = currentX;
					toY = currentY;

					addDrawInfo(); //draw left
				};
				currentX = 0;
				console.log('down')
				toY = (i + 1) * slopeHeight;
				addDrawInfo(); //draw down
			}
			console.log('')
		};

		console.log(drawI)

		var arrayOfSvgPieces = [];
		arrayOfSvgPieces.push('<svg width="800px" height="2000px"  viewBox="0 0 800 2000">')
		for (var i = 0; i < drawI.length; i++) {
			var curr = drawI[i];
			arrayOfSvgPieces.push('<path stroke="' + curr.color + '" stroke-width="' + curr.thickness + '" fill="none" d="');
			//arrayOfSvgPieces.push('<path stroke="#979797" stroke-width="1" fill="none" d="');
			arrayOfSvgPieces.push('M' + (offsetX + curr.from.x) + ',' + (offsetY + curr.from.y));
			arrayOfSvgPieces.push('L' + (offsetX + curr.to.x) + ',' + (offsetY + curr.to.y));
			arrayOfSvgPieces.push('"/>');
		};

		arrayOfSvgPieces.push('" />');
		arrayOfSvgPieces.push('</svg>');

		var svgCode = arrayOfSvgPieces.join("");
		console.log(svgCode);
		$("#svgWrapper").html( svgCode );


		function addDrawInfo(){
			console.log('draw from ' + fromX + ',' + fromY + " to " + toX + ',' + toY);
			drawI.push( {from: {x: fromX, y:fromY}, to: {x: toX, y: toY}, thickness: thickness, color: currentColor} )
			fromX = toX;
			fromY = toY;
		}
	}
})



		// var segments = [
		// 	{id: 1, length: 100, type: "primary", lanes: 5},
		// 	{id: 2, length: 400, type: "residential", lanes: 2},
		// 	{id: 3, length: 20, type: "secondary", lanes: 4},
		// 	{id: 4, length: 400, type: "primary", lanes: 6},
		// 	{id: 5, length: 300, type: "residential", lanes: 2},
		// 	{id: 6, length: 200, type: "residential", lanes: 3},
		// 	{id: 7, length: 100, type: "primary", lanes: 5},
		// 	{id: 8, length: 400, type: "residential", lanes: 2},
		// 	{id: 9, length: 20, type: "secondary", lanes: 4},
		// 	{id: 10, length: 400, type: "primary", lanes: 6},
		// 	{id: 11, length: 300, type: "residential", lanes: 2},
		// 	{id: 12, length: 200, type: "residential", lanes: 3},
		// 	{id: 1, length: 100, type: "primary", lanes: 5},
		// 	{id: 2, length: 400, type: "residential", lanes: 2},
		// 	{id: 3, length: 20, type: "secondary", lanes: 4},
		// 	{id: 4, length: 400, type: "primary", lanes: 6},
		// 	{id: 5, length: 300, type: "residential", lanes: 2},
		// 	{id: 6, length: 200, type: "residential", lanes: 3},
		// 	{id: 7, length: 100, type: "primary", lanes: 5},
		// 	{id: 8, length: 400, type: "residential", lanes: 2},
		// 	{id: 9, length: 20, type: "secondary", lanes: 4},
		// 	{id: 10, length: 400, type: "primary", lanes: 6},
		// 	{id: 11, length: 300, type: "residential", lanes: 2},
		// 	{id: 12, length: 200, type: "residential", lanes: 3},
		// ];

		function getColorFromType(type){
			if (type == 'residential') {
				return '#50E3C2'
			}else if (type == 'motorway') {
				return '#4990E2'
			}else if (type == 'living_street') {
				return '#F6A623'
			}else if (type == 'unclassified') {
				return '#F8E81C'
			}else if (type == 'tertiary') {
				return '#8B572A'
			}else if (type == 'primary') {
				return '#BD0FE1'
			}else if (type == 'secondary') {
				return '#9012FE'
			}else {
				return '#D0011B'
			}
		}

		</script>
		<link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">
	</body>
	</html>