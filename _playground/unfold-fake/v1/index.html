<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Unravel</title>
  </head>
  <body>
    <canvas id="myCanvas" width="1000" height="500"></canvas>
    <button id="unfold">Unfold</button>
    <style type="text/css">
    body{
      background: #eceaea;
    }
    canvas{
      background: white;
      margin: 30px;
    }

    #unfold{
      position: fixed;
      top: 30px;
      left: 30px;
    }
    </style>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/3.0.14/turf.js"></script>
        <script type="text/javascript" src="./js/async.min.js"></script>
        <script type="text/javascript" src="./js/jquery.easing.1.3.js"></script>
        <script type="text/javascript" src="./js/perlin.js"></script>
        <script>
            var bendness = [0.04908289148283984,-0.3443149407836472,-0.3931868090063517,-0.43593380693403105,-0.873699084969644,-0.9233193209142883,-0.9344579948505043,-1.330484788097806,-1.543077114462335,-1.683181365368796,-2.0902618122210015,-2.065897890291808,-1.9564878624256608,-1.7450029490752286,-1.5644528622930238,-1.368070729007286,-1.1257328898378773,0.43397528091793447,0.853357779945668,0.9357449052300808,1.0502103182732299,1.2566832445704677,1.3930286802601586,1.3163006812724234,1.2911700027814277,1.2320941812159845,1.2048925589056125,0.9770817763135256,0.9421564661217872,0.6373661077951738,0.45133929502674164,0.4016615036841813,0.10564056476937367,0.04120932543105482,-0.08192067236029743,-0.21920790883473273,-0.2571667092174721,-0.2571667092174721,-0.8661743786915395,-1.384137317908312,-1.5475116747713855,-1.677661757860733,-2.0106460970952185,-2.532665627933625,-2.5624876026615766,-2.5196196333547505,-2.4495651255822395,-2.580823651152741,-2.718764634377976,-2.926533085239953,-3.1289073428085885,-3.76477443042279,-3.7621015566720644,-3.7621015566720644,-3.759281896500056,-3.705244232642258,-3.682120151438994,-3.647368387421807,-3.647368387421807,-3.640577542060214,-3.5861117515391925,-2.486814978752591,-2.486814978752591,-1.5868135139068045,0.02140787471148542,0.02565934944163928,0.04847638013040978,0.12219962795131778,0.3446785588613466,0.37873612178077565,0.848339801455495,0.9501912170616151,1.5085498546899316,1.5589798853042112,1.1048332321144017,0.8310370563717697,0.5099366054524808,0.5297158131801325,0.5519414611750335,-0.13721351176388907,-0.05199885151421313,-0.011060849608952594,0.007375184652346434,0.13691846427229848,0.3260192723345199,0.4117490284379528,0.5207987984539386,0.7677234736987657,0.7698732345862709,0.7709492462737444,0.8258837738400189,0.8573049606457062,0.9119855610809964,1.0096969326924636,1.0177763601167271,1.1324364175736719,1.1818954794308638,1.315681943407185,1.4800092696765432,1.6268349493627738,1.9787074673188272,2.193389501653087,2.720724795148044,3.723322094682999,4.3619596555091675,4.709713676229967,5.082963698286221,5.2419713402243815,5.325988105422198,5.546755735262764,5.897162200114849,6.18777285817373,8.659981897948683,8.991829141393396,9.195473726921136,9.504647041715657,9.783260170129097,10.25382004421624,10.365243542090525,10.40009949121088,10.385426994442241,10.30463965310912,10.211861185859334,9.863621562985827,9.863621562985827,9.545603271016716,9.52157219139201,9.36331206151442,9.36331206151442,9.321682177376374,6.550476059637845,3.7520772222929963,1.9454240926954753,0.24993573330698382,-2.121386226627351,-8.067566116112062,-11.021978280335475,-15.599613815417683,-16.057434653917426,-35.38901944981592,-35.38901944981592,-37.62793486240855,-38.09947638568758,-38.48560207200376,-39.013835078572356,-40.09330070891599,-42.30094248106252,-44.66786296738701,-46.75613761756972,-48.63585852538483,-50.1962062582669,-52.30636237386602,-54.08370622990799,-54.21616695533328,-54.258645607928315,-55.2190361768063,-55.42763116975016,-55.96693644143386,-56.52889244024584,-56.52889244024584,-57.76355931527473,-57.76355931527473,-58.63908109407032,-58.77246853758231,-60.45331996786183,-60.618523583748356,-61.19086859547565,-63.08178976096508,-65.84518788272453,-66.35558349394842,-66.58426148799072,-67.88344017867666,-68.07112586842527,-68.29983414228025,-68.29983414228025,-68.56142815331918,-68.56142815331918,-69.04713010862258,-69.6285414026014,-70.88486936508878,-72.3307617750587,-72.77678398309763,-73.1927644532534,-73.50959526303586,-73.8405605439226,-74.07592582926316,-74.70338052954946,-73.0216767162043,-72.79165950795664,-72.60122858501188,-72.3125349698488,-72.230933049653,-72.15330188873418,-72.00333769784845,-72.13941928965232,-72.13941928965232,-72.50068517712668,-73.56237292385629,-73.56237292385629,-73.87440720691882,-74.23302742584633,-74.66345602087495,-75.16124220921097,-75.9175582621532,-76.84591322763424,-76.84591322763424,-77.51921192833936,-78.5510714838797,-80.08222634249387,-80.74378018070911,-81.23128974831502,-82.30465903516108,-86.08612318144674,-90.23505396151188,-90.23505396151188,-91.35672657245061,-91.35672657245061,-92.47028975807348,-95.12507221658348,-96.99124380793558,-99.58662015931748,-101.38551453367245,-106.04642304887045,-106.04642304887045,-108.04239899517393,-116.4088165777614,-118.42144513639016,-119.43735454083924,-120.00366276785087,-122.68069414880745,-123.55422787169539,-124.84301699399259,-127.38058841066447,-127.38058841066447,-128.7798527747558,-131.4183463253005,-133.67076571703103,-135.65813431658694,-137.37419115543048,-137.43940901901033,-137.61962938606507,-137.5006922644161,-135.92702754680283,-135.92702754680283,-134.1998715904507,-133.90933621186412,-133.1074617883013,-132.2843471342486,-129.83430421317235,-125.04597758424552,-122.5710863612602,-122.5710863612602,-118.14005354781398,-109.44491816005302,-109.09181005971732,-109.09181005971732,-101.69875406136907,-101.50117905713728,-101.50117905713728,-100.60655490373699,-100.28776660878634,-99.86813761449434,-98.84832367072647,-95.62205362291866,-95.62205362291866,-86.04475054572526,-86.04475054572526,-85.1517399412694,-84.36726663221316,-83.53290402117898,-81.6358595228345,-71.03356235746946,-67.29711086542397,-66.15777746605318,-64.62869615288082,-63.97393030874571,-56.4289378783119,-55.74466416698874,-55.055081337013235,-54.035644892737196,-52.64724831043475,-51.60404874460016,-50.53178609572228,-49.322994017252086,-48.819521206777154,-47.07425582968858,-46.34972385322851,-46.34972385322851,-43.14756961049284,-40.32061959444195,-36.69044118843294,-33.56855304418775,-31.881823656282563,-31.178907217529513,-29.41932261232853,-28.36918799688351,-25.779556448527387,-22.05898473192076,-20.296277737661512,-18.218804671895327,-17.041798859364803,-16.02617567705147,-16.02617567705147,-14.638784646279646,-13.767061039705823,-12.906622292530642,-12.089087728560457,-11.175433036994605,-9.884487096614862,-9.884487096614862,-7.232624486495638,-5.810519564364768,-5.810519564364768,-1.7632861038671308,-1.7632861038671308,0.41715275209867286,-1.0824657871660293,-6.549502266031482,-10.744724042295957,-13.816271521640033,-15.713178264886665,-15.713178264886665,-16.04400216348813,-17.025172469649533,-17.570266600727336,-18.382675111333242,-19.90575198734507,-23.39783427480222,-25.676891587835485,-29.770045115567086,-32.13843930370683,-33.83087521429343,-39.437961516751784,-43.48941927850797,-44.72564599916063,-49.98884008584241,-55.074964102837384,-55.70872617531131,-56.98310675458322,-58.409346950094005,-59.46866878343155,-62.67257759071447,-63.195191307570326,-64.08201600484972,-65.92569892053132,-69.0019676984308,-71.78086049108117,-72.31486181147557,-74.99865917494958,-78.44758328405942,-87.98582283421467,-88.40400705065929,-92.91266058517192,-93.43832966707794,-97.7756414017299,-99.31256629391999,-104.29904747225726,-104.56784115923881,-105.59783436583461,-106.38910871545283,-110.83775897200644,-113.1613437993168,-113.66886136659775,-115.40571282945359,-115.63902605837063,-115.95833360019037,-116.31440356473718,-120.27597927176225,-120.5989458026296,-121.59738155140144,-122.6403032121242,-123.8815368543062,-125.85453593547982,-127.56107842742313,-132.36114730740383,-134.90664423904582,-139.16410811862704,-143.59608132492804,-143.78986892626403,-144.26701667919906,-146.80565542238946,-148.0106068226106,-152.149212861024,-154.87588227383026,-155.16314803005912,-155.9292145386081,-159.67946193398836,-161.314444109124,-170.32913025331152,-174.6543937728352,-175.57540850632904,-175.9833711601417,-178.09072559854155,-179.01721490451337,-179.24945414154024,-179.63779110184498,-180.96153968540614,-181.41099949936586,-182.8848067318039,-184.01671539976553,-185.51220508799167,-193.57254938582753,-193.97462393106787,-194.1446632080865,-194.4812283856519,-194.76365965728144,-197.3772049974517,-198.51310108198243,-198.6382174251862,-198.88507073613732,-203.76899762765493,-211.05130786988673,-222.41728755706652,-222.41728755706652,-223.7402143210545,-225.41361806463533,-226.85927260185667,-226.87440436256293,-226.31835295576047,-226.31835295576047,-226.18890543864597,-226.0754053757745,-225.31921662059403,-225.15487775936913,-224.99005815398652,-224.42504993325667,-224.42504993325667,-223.16166976752186,-223.12604368279483,-222.38336109934437,-221.78109713176104,-221.58937213195577,-219.377025185633,-218.56738480160038,-218.30033468924648,-217.47616487921516,-217.37142784861476,-217.37142784861476,-217.22861020991252,-217.0984869924381,-216.00707353586336,-215.47425124290316,-214.53034610684097,-213.8210975563926,-213.5448560538524,-212.0237260588151,-211.89483003444866,-210.86454106515885,-210.51455621878472,-210.30897936813665,-208.80917063186666,-207.34747185785523,-207.2650814349313,-207.07071993226668,-204.65152493777975,-204.31779658523783,-203.18784913211653,-202.6096072673348,-201.82476252403046,-201.72339277736717,-201.42618109784632,-201.09103439780506,-200.690508818612,-199.66231184467722,-199.27280083301662,-199.09091998957422,-198.262108045241,-197.98940789973597,-196.8255824484578,-196.74220631402125,-196.5181850645597,-196.21845311008315,-193.14625774942704,-192.9165820474151,-192.05732478475886,-191.54966830796297,-189.894413314943,-188.88137556736604,-187.70208878308927,-187.49948304877728,-187.02577100432654,-186.93022450896365,-186.42571533574846,-185.67313524765473,-185.1241489652774,-184.87548355689853,-184.2666699759726,-183.30094857728704,-182.89927306487823,-182.35028885856048,-181.18087921333165,-180.8274223648441,-180.4113545643072,-179.80314484328085,-179.49928275849527,-176.42738353728566,-175.28817363761073,-173.26017625790223,-172.51950141442023,-172.119473393862,-172.0183148128034,-171.8090141819598,-171.8090141819598,-171.68066164095717,-171.52130708582695,-171.3769752017372,-171.3059357936429,-170.56060278083305,-169.98459991464313,-169.98459991464313,-168.46532747435015,-168.2052686444182,-163.13010828491656,-160.3333566131563,-155.6791976661766,-150.2928426040977,-149.25738918328818,-146.40829987310372,-146.29204893552355,-145.0787402677638,-142.44065047664094,-141.96544374495318,-140.7022059181088,-139.65285171258995,-138.31083215573335,-138.31083215573335,-136.28095146450812,-133.11452209946276,-132.1726786455033,-127.2667648301931,-124.78442205819795,-121.93806113240032,-117.8882648997818,-112.73873903638093,-103.10799662187378,-101.28773876088997,-97.5509780184201,-95.25099033687468,-95.25099033687468,-91.15124088144739,-90.9325485430644,-90.7150326596153,-89.83784481311227,-89.34295867535639,-84.94230889399466,-82.28522473412727,-82.28522473412727,-76.83174437714308,-76.83174437714308,-73.34732428691211,-70.93742980389754,-70.93742980389754,-68.57129889151724,-62.55380668770897,-61.354950509798414,-58.09203143733998,-56.61067480977954,-49.37710809046223,-49.37710809046223,-48.33944320841567,-46.227837865537026,-44.96456565558515,-43.2103611274531,-40.75107054001569,-37.929537332370614,-33.6206383400679,-29.942673657749424,-28.45728907101136,-27.48090380700512,-25.502950568864435,-24.46624097447102,-21.208785180639325,-18.813560925397724,-18.813560925397724,-17.516307670624315,-14.299231994952606,-13.669582360207983,-9.836486146127868,-4.985689241913747,0.4020571864360818,-0.061227631812016625,-0.07892226875549113,-0.15791611230110902,-0.30192842993278646,-0.5527623106703459,-0.6209380982459152,-0.6809330037796144,-0.744399683546817,-0.7865307510696766,-0.7588433667947356,-0.7738726574336852,-0.7235877754410467,-0.570676523204952,-0.5407676388050504,-0.5310843591237244,-0.44837630490178526,-0.40414958008477697,-0.33751485615687216,-0.32649532676794024,-0.3093343141465539,-0.24004312941156059,-0.21313851077195523,-0.20662413365312204,-0.19181924702729702,-0.11464451488711802,-0.04721378153249134,-0.04721378153249134,0.010367193273509656,-0.07780245867479607,-0.1271275656472426,-0.217641483314992,-0.2518253493805105,-0.21223135458058096,-0.07946531523202793,0.00007573321681775269,-0.018659512937574618,-0.09747864424525687,-0.07628039339670067,-0.07628039339670067,-0.040174963100639616,-0.040174963100639616,-0.00948753876923547,-0.01795194938313216,-0.021899119743920892,-0.07881640094990416,-0.07779272946208948,0.0071513117342192345, 2.1300381620297912,2.747448140833967,3.2430939450304095,3.9019520831956243,6.463730124673816,7.196095961849437,7.79719243363968,8.13818247468214,9.858803015285389,11.502680753499476,12.413692784739851,13.315724718520983,13.771245850870173,14.14257156088047,14.256125903316843,14.574132134118258,14.684962419736507,15.904641599550587,16.17481577788533,17.182934033550055,17.604924895408203,19.034770667184375,19.56812699580496,19.335926768642366,13.84597375049077,10.351736075203917,8.90486511106542,8.036654593675053,4.078989156760599,2.7547165252423156,2.7547165252423156,2.294797667680882,1.3001834961544319,-0.4231724022237131,-2.351460831876352,-4.851603350139953,-6.465896528348594,-7.7008588391843205,-8.878229820746014,-10.141194495903164,-11.510187346381258,-12.297073685675173,-13.523035200300228,-15.797811431631658,-16.12282778197732,-16.426028914175845,-16.005164861457615,-14.889032753225479,-14.001454634264633,-13.745446107924067,-13.399174760701044,-12.648681565687184,-12.106781338586188,-11.528462139687122,-10.81122887450988,-9.733448015648264,-9.07237247192893,-8.334468473709194,-7.711609044016086,-7.3959194368433145,-7.3959194368433145,-7.3517108904799215,-6.965073965693364,-3.5524015960631914,-3.5524015960631914,-3.08169125648908,-3.08169125648908,-2.7818663569026967,-2.5294611801516567,-2.5294611801516567,-1.7706580437520643,-1.7706580437520643,-0.9772895465856664,-0.9772895465856664,-0.0351191175192298,4.309095003596553,4.8123619515149585,14.8911049310708,15.84624656762469,24.292351491619115,24.729204946909476,27.31512474756289,31.90483008184208,34.09394829838163,40.664923342825546,41.11020352306207,53.321207924592954,54.95939779076457,55.36326158491693,60.734294655892654,65.49174882579405,67.13105379754381,68.5644606843374,74.72645012631142,75.69397167851719,76.57108041051833,76.73954562144797,77.15170304805258,77.79719293237338,78.20925065726817,80.49629081254056,82.96045953698695,83.14363461105756,86.52979802575521,94.67366703128846,96.50119584869992,97.98746670141281,98.52063494777087,98.87269419827021,100.29759433924391,101.92120432921399,104.51624658214246,105.51307464819502,105.97111059074302,107.94786304135141,110.36438954597872,111.09662532770358,111.24047952493424,111.66288812301866,112.08739083180228,112.59022956387776,119.67302217601832,121.37063366150164,125.53019171406993,127.07626958115247,127.80466078976463,129.00689883741927,130.69560520423272,136.74806813108614,137.72899492640533,146.49863231078473,151.56197391650778,153.706243885935,158.58380793220078,159.7495095750662,161.8222007617603,162.5660346944435,163.28235908353383,164.0332011747638,165.18386053593213,166.4303715599574,167.2892481853254,168.15666084916722,169.29432529598932,170.71756569473916,171.81813237522988,173.07594659428423,174.6811010061342,176.3170162116104,178.25757196163772,179.83786313900373,181.2583744589706,182.34154824413895,186.78919689154156,190.49070576242025,195.7216862503759,195.7216862503759,197.13476201040146,198.78267943077105,200.8218412440251,202.9535316015822,213.59702151788088,217.84588792690772,220.51175882727352,225.14519779712282,226.6794273437008,231.14561142220714,244.51892482502672,246.00774871868794,246.88923429157944,248.3814708135817,250.05782738825587,250.3992824839679,251.08678277225954,251.95670487415782,252.1472820348406,252.7007112081892,254.0142542116132,255.0057133805126,256.08654402727143,256.4432554543705,256.8956822324469,257.1546583765862,258.82181364602275,261.0516017697571,262.609247274444,263.8525390735176,266.22844482893424,267.78384013533423,268.2718337975389,271.57331892558227,278.43588240969257,285.17380510580665,288.7653778994388,300.9259570634729,312.0623106266678,330.0257226248616,330.57069562674405,335.2082056381537,345.6264905109483,347.09751557290497,351.2792042464698,372.35055971694123,393.0625704155466,414.4180781537059,435.67326215343496,456.38847784926816,476.86879860568024,488.65504181792244,493.8459137158809,494.2553594607723,495.36216882326903,498.00436513576506,510.3994002989916,517.5761385822245,522.9194511377655,532.246430760672,534.7142500147984,535.3283317379992,535.5970624236804,535.7209249882624,539.4346515282909,559.4134317889648,569.9494057374379,576.8257301797332,579.6963979180948,583.986357853958,590.759466791726,591.4023049898733,592.3095080392959,592.6600722715004,595.2710575663166,597.00649998218,597.5114023268277,597.2910988722476,597.0999704298383,596.8363763181658,596.3909648263441,596.3586279298809,596.3586279298809,596.2316616618057,593.918982610576,593.6145365720251,593.4138638410377,593.2909475421402,590.1497670872011,588.7032859671424,586.3326277194408,586.3326277194408,586.1632899613467,586.0282760118766,585.8449404286198,585.2368505638653,585.021887064466,584.7171608041826,584.3894658332729,584.3470533844675,584.0037674580174,583.8735057306867,583.3482763628908,583.1569327347613,582.8894343040445,579.7385161809441,578.1632374992178,577.8732085643778,577.2824248465599,575.7718344608288,572.2603728466736,570.4620918628702,570.2896582610142,570.0379673880802,569.3075131665992,568.773878819725,566.1607978515394,564.1424167601397,562.011312400502,557.9306122330831,557.2100714903834,557.2100714903834,556.8759806760015,556.657842716812,556.111842154929,555.7176489143535,555.5816645006591,555.5816645006591,554.8375325933696,554.582817529563,551.1631417497226,550.0261260231193,548.8347919105904,544.2026436710598,542.7408517130132,539.6786372297076,539.0028074572695,539.0028074572695,537.6136948357025,536.0754306262329,534.9336089231879,533.8457711669669,531.681941977437,529.8183057140807,528.4610875872725,527.597246150573,526.5337445045825,524.7830224383017,521.2716478129717,518.8545795572531,518.157073058338,517.4182443659615,516.2123619671527,515.4108072992099,514.9309516859703,513.0616840962762,510.23472344379934,508.5038717534742,505.99330524825814,503.67064706584324,501.0564595940232,498.4075737400069,495.91468747249337,493.8685589909453,490.82694976450125,488.7428984939577,475.6803364410614,470.4283989629041,470.4283989629041,467.6089665239931,464.468848706731,461.0027059028232,458.0065723861567,454.0527954205611,450.5455016319181,447.19881432174657,443.5075104005275,440.31022218840894,437.95939670254893,436.2985032851416,428.73823171635536,423.353898834911,416.7668280450978,406.84832330086306,397.34675290056157,392.9467504130637,392.45046285501144,385.8934395944241,383.70762825468364,372.3660169630591,369.9548148313081,365.98531157186835,361.5685741367115,357.2535179878075,356.73223030841336,355.9057264160392,352.13293491588865,347.5568442057631,341.94969548113727,334.7106348018676,327.2796007448371,326.9897720623501,325.5604605953938,324.53485691663604,323.40440851675794,315.1807198798765,313.4402154517861,312.22485558667586,311.417216503555,311.417216503555,300.9574547668283,298.4969390496731,294.03933173410405,290.58632067818485,290.1223670626848,289.1495593093191,282.8666587307948,280.6553573552021,277.8407972526693,267.6594489700774,262.99155310669175,256.4006906898942,252.65544266894335,248.95453793117053,247.9365947402414,247.50475014131916,241.31955600468632,240.58901320760742,237.25172991317572,235.10142308716036,234.7018879173122,232.97215965103715,231.30431922586104,225.48397671324778,218.856975489692,208.49234984804139,200.0715427769111,196.9077685329181,193.80653065163574,190.4724625390229,187.10142869960953,172.3169534162023,171.24319064787653,151.53974390627764,143.6178093751704,133.61611923880082,132.31184253964352,114.36575653879254,112.3697090162151,95.92378737740523,91.95300205174601,88.81842642948459,87.61880667035268,83.59085118543453,73.91418064926052,65.59660899011317,64.45592029925649,63.32608714765797,63.074600312966254,60.92374504102531,42.1074790385959,37.22457777894533,34.47152490799215,25.40042666250872,21.21965720691378,21.21965720691378,20.509396987831337,20.213763334935265,16.24611014193033,13.24908200106313,3.9411105822983927,1.8144757586701417];
            console.log(bendness.length);

            noise.seed(Math.random());
            var canvas = document.getElementById("myCanvas"); //reference canvas
            var canvasContext = canvas.getContext("2d"); //set context

            init();

            function init(){
              drawSnake();
            }

            function drawSnake(){
              var snakeLength = 1056*4;
              var slopeWidth = 400;
              var slopeHalfDiameter = 20;
              var origin = {x:100, y:100}
              var currentRow = 1;
              var slopeRadius = slopeHalfDiameter/Math.PI;
              for (var i = 0; i < snakeLength; i++) {
                var x = 0
                var y = 0
                var stage;
                var modulo = i % ((slopeWidth + slopeHalfDiameter) * 2);
                var currentI;

                if (modulo < slopeWidth) {
                  currentI = modulo;
                  if (stage != 'right') {
                    currentRow ++;
                  };
                  stage = 'right';
                }else if(modulo < slopeWidth + slopeHalfDiameter){
                  currentI = modulo - slopeWidth;
                  stage = 'downAfterRight';
                }else if(modulo < slopeWidth*2 + slopeHalfDiameter){
                  currentI = modulo - slopeWidth - slopeHalfDiameter;
                  
                  stage = 'left';
                }else{
                  currentI = modulo - slopeWidth*2;
                  if (stage != 'downAfterLeft') {
                    currentRow ++;
                  };
                  stage = 'downAfterLeft';
                }

                //var fakeOffset = noise.simplex2(i/100, 0) * 5;
                var fakeOffset = bendness[Math.floor(i/4)]/20;

                var angle;
                var horizontal;
                switch(stage) {
                    case 'downAfterRight':
                        horizontal = slopeWidth;
                        angle = 180/slopeHalfDiameter * currentI;
                        break;
                    case 'downAfterLeft':
                        angle = - 180/slopeHalfDiameter * currentI + 180;
                        horizontal = 0;
                        break;
                    case 'right':
                        angle = 0;
                        horizontal = currentI;
                        break;
                    case 'left':
                        horizontal = slopeWidth - currentI;
                        angle = 180;
                        break;
                }
                

                var dx = Math.sin(toRadians(angle)) * slopeRadius;
                var dy = Math.cos(toRadians(angle)) * slopeRadius;

                var dxByCurve = Math.sin(toRadians(angle)) * (fakeOffset);
                var dyByCurve = Math.cos(toRadians(angle)) * (fakeOffset);

                if (stage == 'downAfterLeft') {
                  dyByCurve = -dyByCurve;
                };
                


                var cursor = {
                  x: origin.x + horizontal,
                  y: origin.y + slopeRadius * currentRow * 2,
                }

                // canvasContext.beginPath(); 
                // canvasContext.fillStyle = '#D8D8D8';
                // canvasContext.arc(cursor.x, cursor.y, 1, 0, 2 * Math.PI, false);
                // canvasContext.fill();
                // canvasContext.closePath();

                // canvasContext.beginPath(); 
                // canvasContext.fillStyle = '#D8D8D8';
                // canvasContext.arc(cursor.x + dx, cursor.y - dy, 1, 0, 2 * Math.PI, false);
                // canvasContext.fill();
                // canvasContext.closePath();

                canvasContext.beginPath(); 
                canvasContext.fillStyle = '#4990E2';
                canvasContext.arc(cursor.x + dxByCurve + dx, cursor.y - dyByCurve - dy, 1, 0, 2 * Math.PI, false);
                canvasContext.fill();
                canvasContext.closePath();
              };
            }







            //--------------------------
            //         Helpers
            //--------------------------

            function getAngleDifference(angle1, angle2){
              var d = angle1 - angle2
               while (d < -180) {
                  d += 360;
                };
                while (d > 180) {
                  d -= 360;
                };
              return d;
            }

            function getBearing(from, to){
              var fromPoint = turf.point([from.lon, from.lat]);
              var toPoint = turf.point([to.lon, to.lat]);
              return turf.bearing(fromPoint, toPoint);
            }

            function getDistance(from, to){
              var fromPoint = turf.point([from.lon, from.lat]);
              var toPoint = turf.point([to.lon, to.lat]);
              return turf.distance(fromPoint, toPoint);
            }

            function getDestination(from, distance, bearing){
              var fromPoint = turf.point([from.lon, from.lat]);
              var toPoint = turf.destination(fromPoint, distance, bearing);
              return {lon: toPoint.geometry.coordinates[0], lat: toPoint.geometry.coordinates[1]}
            }

            function toRadians(degrees) {
              return degrees * Math.PI / 180;
            };

            function getCoordinateFromNode(node, nodes){
              return nodes[node];
            }

            function clearCanvas(){
              canvasContext.clearRect(0, 0, canvas.width, canvas.height);
            }

        </script>
  </body>
</html>